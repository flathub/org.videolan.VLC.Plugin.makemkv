id: org.videolan.VLC.Plugin.makemkv
build-extension: true
runtime: org.videolan.VLC
runtime-version: stable
branch: 3-23.08
sdk: org.freedesktop.Sdk//23.08
tags:
- proprietary
separate-locales: false
appstream-compose: false
build-options:
  env:
    V: '1'
modules:
- name: makemkv-bin
  buildsystem: simple
  build-commands:
  - mkdir -p tmp
  - echo accepted > tmp/eula_accepted
  - make PREFIX=/app/share/vlc/extra/makemkv install
  - install -Dp -m 644 src/eula_en_linux.txt --target-directory=/app/share/vlc/extra/makemkv/share/licenses
  sources:
  - type: archive
    url: http://www.makemkv.com/download/makemkv-bin-1.17.5.tar.gz
    sha256: cb009c31f69601e2f66e315925a09ad175bad041f27c5096d7b06dd5004df04f
    x-checker-data:
      type: html
      url: https://www.makemkv.com/download
      version-pattern: MakeMKV v([\d\.]*)
      url-template: https://www.makemkv.com/download/makemkv-bin-$version.tar.gz
- name: makemkv-oss
  config-opts:
  - --with-pic
  - --enable-shared
  - --disable-static
  - --disable-gui
  - --prefix=/app/share/vlc/extra/makemkv
  - DESTDIR=/
  - ffmpeg_CFLAGS=-I/app/include
  post-install:
  - install -Dp -m 644 License.txt --target-directory=/app/share/vlc/extra/makemkv/share/licenses
  - install -Dp -m 644 org.videolan.VLC.Plugin.makemkv.appdata.xml --target-directory=${FLATPAK_DEST}/share/appdata
  - appstream-compose --basename=org.videolan.VLC.Plugin.makemkv --prefix=${FLATPAK_DEST}
    --origin=flatpak org.videolan.VLC.Plugin.makemkv
  sources:
  - type: archive
    url: http://www.makemkv.com/download/makemkv-oss-1.17.5.tar.gz
    sha256: fc2f4b0dc53117ab49927d9a415fa73082d1a4ae47df0c4e30cc4710c4c2fc22
    x-checker-data:
      type: html
      url: https://www.makemkv.com/download
      version-pattern: MakeMKV v([\d\.]*)
      url-template: https://www.makemkv.com/download/makemkv-oss-$version.tar.gz
  - type: file
    path: org.videolan.VLC.Plugin.makemkv.appdata.xml
- name: envvars
  buildsystem: simple
  build-commands:
  - mv makemkv-env.sh /app/share/vlc/extra/makemkv
  sources:
  - type: file
    path: makemkv-env.sh

